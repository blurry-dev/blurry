<!DOCTYPE html><html lang="en"><head><title>Plugins: write a Markdown plugin · Blurry</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Documentation for Blurry's Markdown plugins"><link href="https://blurry-docs.netlify.app/plugins/write-a-markdown-plugin/" rel="canonical"><link rel="shortcut icon" href="/favicon.png"><script type="application/ld+json">{"@context": "https://schema.org", "author": {"@type": "Person", "name": "John Franey", "url": "https://johnfraney.ca"}, "sourceOrganization": {"name": "Blurry"}, "@type": "WebPage", "name": "Plugins: write a Markdown plugin", "abstract": "Documentation for Blurry's Markdown plugins", "datePublished": null, "url": "https://blurry-docs.netlify.app/plugins/write-a-markdown-plugin/"}</script><meta property="og:type" content="website"><meta content="https://blurry-docs.netlify.app/plugins/write-a-markdown-plugin/" property="og:url"><meta property="og:description" content="Documentation for Blurry's Markdown plugins"><meta property="og:site_name" content="Blurry"><style>:root{--box-shadow:1px 1px 3px #999;--color-blue:aliceblue;--color-yellow:cornsilk;--dark:#1c1b1a;--light:#fffffd;--line-height:1.8;--color:#805c06;--color-background:var(--light);--color-background-accent:#fff;--color-faint:#d9d9d9;--color-text:var(--dark);}@media (prefers-color-scheme:dark){:root{--color:wheat;--color-background:var(--dark);--color-background-accent:#000;--color-faint:#333;--color-text:var(--light);}}body{background-color:var(--color-background);color:var(--color-text);column-gap:2rem;display:grid;font-family:-system,sans-serif;grid-template:"header header" auto
        "nav    main" auto
        "nav    footer" auto / 24ch 1fr;margin:0 auto;max-width:1400px;padding:0 0.75rem;row-gap:1rem;}@media(max-width:800px){body{grid-template:"header" auto
            "nav" auto
            "main" auto
            "footer" auto;}}body>header{grid-area:header;padding:0.5em 0;border-bottom:1px solid var(--color-faint);}body>details>summary{display:none;}@media(max-width:800px){body>details>summary{border:1px solid var(--color-faint);border-radius:0.25rem;cursor:pointer;display:inline-block;padding:0.25rem 0.5rem;}body>details>summary::before{content:'📘';filter:sepia(100);margin-right:0.25rem;}body>details[open]>summary::before{transform:rotate(90);content:'📖';}body>details>nav{margin-top:1rem;}}body>nav{grid-area:nav;overflow-y:auto;}body>footer{grid-area:footer;}body>main{grid-area:main;}main>h1,nav>ul{margin-top:0;}main a{text-decoration:underline;}main p{line-height:var(--line-height);}main ul{line-height:var(--line-height);}nav>ul{padding-left:0;}nav ul li{list-style:none;margin:0.25em 0;}nav>ul>li{margin-top:0.75em;}nav>ul:first-child>li{margin-top:0;}nav li ul{padding-left:1em;}nav a{display:inline-block;padding:0.5em 0;}a{color:var(--color);text-decoration:none;}figure{margin:1.2em inherit;width:auto;max-width:100%;}figure>figcaption{font-style:italic;text-align:center;}figure>picture+figcaption::before{content:"🖼️ ";font-style:normal;padding-right:0.25em;}figure picture img{max-width:100%;height:auto;}picture{display:block;text-align:center;}video{max-width:100%;height:auto;}pre{box-shadow:var(--box-shadow);white-space:pre-wrap;}pre>code{display:block;padding:1em;}</style><!-- Fathom - beautiful, simple website analytics --><script src="https://cdn.usefathom.com/script.js" data-site="OEOKWHQN" defer=""></script><!-- / Fathom --></head><body><header><a href="/" class="blurry" rel="noreferrer">Blurry</a></header><details><summary>Menu</summary><nav><ul><li>Getting Started <ul><li><a href="/getting-started/quick-start/" rel="noreferrer">Quick Start</a></li></ul></li><li>Commands <ul><li><a href="/commands/build/" rel="noreferrer"><code>build</code></a></li><li><a href="/commands/runserver/" rel="noreferrer"><code>runserver</code></a></li></ul></li><li>Content <ul><li><a href="/content/markdown/" rel="noreferrer">Markdown</a></li><li><a href="/content/images/" rel="noreferrer">Images</a></li><li><a href="/content/videos/" rel="noreferrer">Videos</a></li></ul></li><li>Templates <ul><li><a href="/templates/syntax/" rel="noreferrer">Syntax</a></li><li><a href="/templates/context/" rel="noreferrer">Context</a></li><li><a href="/templates/examples/" rel="noreferrer">Examples</a></li></ul></li><li>Configuration <ul><li><a href="/configuration/settings/" rel="noreferrer">Settings</a></li><li><a href="/configuration/blurry.toml/" rel="noreferrer">blurry.toml</a></li><li><a href="/configuration/environment-variables/" rel="noreferrer">Environment variables</a></li></ul></li><li>Plugins <ul><li><a href="/plugins/intro/" rel="noreferrer">Intro</a></li><li><a href="/plugins/write-a-markdown-plugin/" rel="noreferrer">Write a Markdown plugin</a></li><li><a href="/plugins/write-an-html-plugin/" rel="noreferrer">Write an HTML plugin</a></li><li><a href="/plugins/write-a-jinja-extension-plugin/" rel="noreferrer">Write a Jinja extension plugin</a></li><li><a href="/plugins/write-a-jinja-filter-plugin/" rel="noreferrer">Write a Jinja filter plugin</a></li></ul></li></ul></nav></details><main><h1>Plugins: write a Markdown plugin</h1><p>A Blurry Markdown plugin actually a Mistune plugin. See the <a href="https://mistune.lepture.com/en/latest/advanced.html#create-plugins" target="_blank" rel="noopener">Mistune plugin docs</a> for more information on writing plugins, and check out the examples of inline and block Markdown plugins below.</p><h2>Example: inline plugin</h2><p>Blurry ships with a simple punctuation plugin, which is a <a href="https://mistune.lepture.com/en/latest/advanced.html#block-level-plugin" target="_blank" rel="noopener">Mistune inline level plugin</a>:</p><pre><code class="language-python">from re import Match

from mistune import InlineParser
from mistune import InlineState
from mistune import Markdown

EM_DASH_PATTERN = r"---"
EN_DASH_PATTERN = r"--"


def parse_em_dash(_: InlineParser, match: Match, state: InlineState):
    pos = match.end()
    state.append_token({"type": "text", "raw": "—"})
    return pos


def parse_en_dash(_: InlineParser, match: Match, state: InlineState):
    pos = match.end()
    state.append_token({"type": "text", "raw": "–"})
    return pos


def punctuation(md: Markdown):
    md.inline.register("punctuation_em_dash", EM_DASH_PATTERN, parse_em_dash)
    md.inline.register("punctuation_en_dash", EN_DASH_PATTERN, parse_en_dash)
</code></pre><h2>Example: block plugin</h2><p>The Mistune plugin Blurry uses to display Python source code in Markdown is an example of a <a href="https://mistune.lepture.com/en/latest/advanced.html#block-level-plugin" target="_blank" rel="noopener">Mistune block level plugin</a>:</p><pre><code class="language-python">import importlib
import inspect
import re

from mistune import BlockParser
from mistune import BlockState
from mistune import Markdown

PYTHON_CODE_PATTERN = r"[\s]*@(?P<language>[a-z]+)&lt;(?P<path>.+)&gt;"


def parse_python_code(_: BlockParser, match: re.Match, state: BlockState):
    language = match.group("language")
    path = match.group("path")
    state.append_token(
        {
            "type": "python_code",
            "attrs": {"language": language, "path": path},
        }
    )
    return match.end() + 1


def render_python_code(_, language: str, path: str):
    module, _, reference_name = path.rpartition(".")
    module = importlib.import_module(module)
    try:
        # If path references a variable within a module
        reference = getattr(module, reference_name)
    except AttributeError:
        # If path references a module
        reference = importlib.import_module(path)
    reference_source = inspect.getsource(reference)

    return f'<pre><code class="language-{language}">{reference_source}</code></pre>'


def python_code(md: Markdown):
    """A mistune plugin to insert Python code."""
    md.block.register(
        "python_code", PYTHON_CODE_PATTERN, parse_python_code, before="list"
    )
    if md.renderer and md.renderer.NAME == "html":
        md.renderer.register("python_code", render_python_code)


def python_code_in_list(md: Markdown):
    """Enable Python code plugin in list."""
    md.block.insert_rule(md.block.list_rules, "python_code", before="list")
</path></language></code></pre></main><footer><p><small> © 2020-2023 <a href="https://johnfraney.ca/">John Franey</a></small></p></footer><link rel="preload" href="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/styles/a11y-light.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/styles/a11y-light.min.css"></noscript><script src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js" async="" defer=""></script><script>window.addEventListener('load', () => hljs.highlightAll());</script><style>aside[role="note"]{--spacing:0.75rem;box-shadow:var(--box-shadow);background:var(--color-background-accent);margin:1rem 0;padding:var(--spacing);}aside[role="note"]::before{background:var(--color-blue);color:var(--dark);content:"🛈 Info";display:block;line-height:1;margin:calc(var(--spacing) * -1);padding:var(--spacing);}aside[role="note"].note::before{content:"📝 Note";background:var(--color-yellow);}aside[role="note"].tip::before{content:"💡 Tip";background:var(--color-yellow);}aside[role="note"]>p:last-child{margin-bottom:0;}.blurry{color:var(--color);filter:blur(0.035em);}table{border:1px solid var(--color-faint);background-color:var(--color-background-accent);box-shadow:var(--box-shadow);}th,td{border-bottom:1px solid var(--color-faint);padding:0.5em;}tr:last-child td{border-bottom:none;}th{text-align:left;}</style><script>
        function onWindowResize(event) {
            const detailsElement = document.querySelector('details')
            window.innerWidth > 800 ? detailsElement.setAttribute("open", "") : detailsElement.removeAttribute("open")
        }
        addEventListener("resize", onWindowResize);
        onWindowResize()
    </script></body></html>